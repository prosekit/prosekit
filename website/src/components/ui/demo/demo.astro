---
import { MultipleFrameworksDemo } from './multiple-frameworks-demo.tsx'
import registry from 'prosekit-registry/registry.gen.json'
import PreactStory from '../../../stories/preact.astro'
import ReactStory from '../../../stories/react.astro'
import SolidStory from '../../../stories/solid.astro'
import SvelteStory from '../../../stories/svelte.astro'
import VueStory from '../../../stories/vue.astro'
import LitStory from '../../../stories/lit.astro'
import VanillaStory from '../../../stories/vanilla.astro'
import DemoCodeGroup from './demo-code-group.astro'

interface Props {
  story: string
  showCode?: boolean
}

const { story, showCode }: Props = Astro.props

const examples = registry.items.filter((example) => example.meta.story === story)

if (examples.length === 0) {
  throw new Error(`Unable to find examples for story ${story}`)
}

const frameworks = examples.map((example) => example.meta.framework)
---

{frameworks.includes('lit') && <script src="../../../stories/lit-register.ts"></script>}
{frameworks.includes('vanilla') && <script src="../../../stories/vanilla-register.ts"></script>}

<MultipleFrameworksDemo frameworks={frameworks} story={story} initialShowCode={showCode} client:idle>
  <Fragment slot="litStoryContent">{frameworks.includes('lit') ? <LitStory story={story} /> : null}</Fragment>
  <Fragment slot="preactStoryContent">{frameworks.includes('preact') ? <PreactStory story={story} /> : null}</Fragment>
  <Fragment slot="reactStoryContent">{frameworks.includes('react') ? <ReactStory story={story} /> : null}</Fragment>
  <Fragment slot="solidStoryContent">{frameworks.includes('solid') ? <SolidStory story={story} /> : null}</Fragment>
  <Fragment slot="svelteStoryContent">{frameworks.includes('svelte') ? <SvelteStory story={story} /> : null}</Fragment>
  <Fragment slot="vanillaStoryContent">{frameworks.includes('vanilla') ? <VanillaStory story={story} /> : null}</Fragment>
  <Fragment slot="vueStoryContent">{frameworks.includes('vue') ? <VueStory story={story} /> : null}</Fragment>

  <Fragment slot="litCodeContent">{frameworks.includes('lit') ? <DemoCodeGroup story={story} framework="lit" /> : null}</Fragment>
  <Fragment slot="preactCodeContent">{frameworks.includes('preact') ? <DemoCodeGroup story={story} framework="preact" /> : null}</Fragment>
  <Fragment slot="reactCodeContent">{frameworks.includes('react') ? <DemoCodeGroup story={story} framework="react" /> : null}</Fragment>
  <Fragment slot="solidCodeContent">{frameworks.includes('solid') ? <DemoCodeGroup story={story} framework="solid" /> : null}</Fragment>
  <Fragment slot="svelteCodeContent">{frameworks.includes('svelte') ? <DemoCodeGroup story={story} framework="svelte" /> : null}</Fragment>
  <Fragment slot="vanillaCodeContent">{frameworks.includes('vanilla') ? <DemoCodeGroup story={story} framework="vanilla" /> : null}</Fragment>
  <Fragment slot="vueCodeContent">{frameworks.includes('vue') ? <DemoCodeGroup story={story} framework="vue" /> : null}</Fragment>
</MultipleFrameworksDemo>
