{"version":3,"file":"prosekit-extensions-loro.js","names":["keymap: Keymap","undo"],"sources":["../src/loro/loro-commands.ts","../src/loro/loro-cursor-plugin.ts","../src/loro/loro-keymap.ts","../src/loro/loro-sync-plugin.ts","../src/loro/loro-undo-plugin.ts","../src/loro/loro.ts"],"sourcesContent":["import {\n  defineCommands,\n  type Extension,\n} from '@prosekit/core'\nimport {\n  redo,\n  undo,\n} from 'loro-prosemirror'\n\nconst commands = {\n  undo: () => undo,\n  redo: () => redo,\n} as const\n\n/**\n * @internal\n */\nexport type LoroCommandsExtension = Extension<{\n  Commands: {\n    undo: []\n    redo: []\n  }\n}>\n\nexport function defineLoroCommands(): LoroCommandsExtension {\n  return defineCommands(commands)\n}\n","import {\n  definePlugin,\n  type PlainExtension,\n} from '@prosekit/core'\nimport type {\n  EditorState,\n  Selection,\n} from '@prosekit/pm/state'\nimport type { DecorationAttrs } from '@prosekit/pm/view'\nimport type { PeerID } from 'loro-crdt'\nimport {\n  LoroCursorPlugin,\n  type CursorAwareness,\n} from 'loro-prosemirror'\n\nexport interface LoroCursorOptions {\n  awareness: CursorAwareness\n  getSelection?: (state: EditorState) => Selection\n  createCursor?: (user: PeerID) => Element\n  createSelection?: (user: PeerID) => DecorationAttrs\n}\n\nexport function defineLoroCursorPlugin(\n  options: LoroCursorOptions,\n): PlainExtension {\n  const { awareness, ...rest } = options\n  return definePlugin(LoroCursorPlugin(awareness, rest))\n}\n","import {\n  defineKeymap,\n  isApple,\n  type Keymap,\n  type PlainExtension,\n} from '@prosekit/core'\nimport {\n  redo,\n  undo,\n} from 'loro-prosemirror'\n\nconst keymap: Keymap = {\n  'Mod-z': undo,\n  'Shift-Mod-z': redo,\n}\n\nif (!isApple) {\n  keymap['Mod-y'] = redo\n}\n\nexport function defineLoroKeymap(): PlainExtension {\n  return defineKeymap(keymap)\n}\n","import {\n  definePlugin,\n  type PlainExtension,\n} from '@prosekit/core'\nimport {\n  LoroSyncPlugin,\n  type LoroSyncPluginProps,\n} from 'loro-prosemirror'\n\nexport function defineLoroSyncPlugin(\n  options: LoroSyncPluginProps,\n): PlainExtension {\n  return definePlugin(LoroSyncPlugin(options))\n}\n","import {\n  definePlugin,\n  type PlainExtension,\n} from '@prosekit/core'\nimport {\n  LoroUndoPlugin,\n  type LoroUndoPluginProps,\n} from 'loro-prosemirror'\n\nexport function defineLoroUndoPlugin(options: LoroUndoPluginProps): PlainExtension {\n  return definePlugin(LoroUndoPlugin(options))\n}\n","import {\n  Priority,\n  union,\n  withPriority,\n  type PlainExtension,\n  type Union,\n} from '@prosekit/core'\nimport type {\n  CursorAwareness,\n  LoroDocType,\n  LoroSyncPluginProps,\n  LoroUndoPluginProps,\n} from 'loro-prosemirror'\n\nimport {\n  defineLoroCommands,\n  type LoroCommandsExtension,\n} from './loro-commands'\nimport {\n  defineLoroCursorPlugin,\n  type LoroCursorOptions,\n} from './loro-cursor-plugin'\nimport { defineLoroKeymap } from './loro-keymap'\nimport { defineLoroSyncPlugin } from './loro-sync-plugin'\nimport { defineLoroUndoPlugin } from './loro-undo-plugin'\n\nexport interface LoroOptions {\n  /**\n   * The Loro instance handles the state of shared data.\n   */\n  doc: LoroDocType\n\n  /**\n   * The Awareness instance.\n   */\n  awareness: CursorAwareness\n\n  /**\n   * Extra options for `LoroSyncPlugin`.\n   */\n  sync?: Omit<LoroSyncPluginProps, 'doc'>\n\n  /**\n   * Extra options for the `LoroUndoPlugin`.\n   */\n  undo?: Omit<LoroUndoPluginProps, 'doc'>\n\n  /**\n   * Extra options for `LoroCursorPlugin`.\n   */\n  cursor?: Omit<LoroCursorOptions, 'awareness'>\n}\n\n/**\n * @internal\n */\nexport type LoroExtension = Union<[LoroCommandsExtension, PlainExtension]>\n\n/**\n * @public\n */\nexport function defineLoro(options: LoroOptions): LoroExtension {\n  const { doc, awareness, sync, undo, cursor } = options\n\n  return withPriority(\n    union([\n      defineLoroKeymap(),\n      defineLoroCommands(),\n      defineLoroCursorPlugin({ ...cursor, awareness }),\n      defineLoroUndoPlugin({ ...undo, doc }),\n      defineLoroSyncPlugin({ ...sync, doc }),\n    ]),\n    Priority.high,\n  )\n}\n"],"mappings":";;;;AASA,MAAM,WAAW;CACf,YAAY;CACZ,YAAY;CACb;AAYD,SAAgB,qBAA4C;AAC1D,QAAO,eAAe,SAAS;;;;;ACHjC,SAAgB,uBACd,SACgB;CAChB,MAAM,EAAE,UAAW,GAAG,SAAS;AAC/B,QAAO,aAAa,iBAAiB,WAAW,KAAK,CAAC;;;;;ACfxD,MAAMA,SAAiB;CACrB,SAAS;CACT,eAAe;CAChB;AAED,IAAI,CAAC,QACH,QAAO,WAAW;AAGpB,SAAgB,mBAAmC;AACjD,QAAO,aAAa,OAAO;;;;;ACZ7B,SAAgB,qBACd,SACgB;AAChB,QAAO,aAAa,eAAe,QAAQ,CAAC;;;;;ACH9C,SAAgB,qBAAqB,SAA8C;AACjF,QAAO,aAAa,eAAe,QAAQ,CAAC;;;;;;;;ACmD9C,SAAgB,WAAW,SAAqC;CAC9D,MAAM,EAAE,KAAK,WAAW,MAAM,cAAM,WAAW;AAE/C,QAAO,aACL,MAAM;EACJ,kBAAkB;EAClB,oBAAoB;EACpB,uBAAuB;GAAE,GAAG;GAAQ;GAAW,CAAC;EAChD,qBAAqB;GAAE,GAAGC;GAAM;GAAK,CAAC;EACtC,qBAAqB;GAAE,GAAG;GAAM;GAAK,CAAC;EACvC,CAAC,EACF,SAAS,KACV"}