{"version":3,"file":"prosekit-extensions-loro.js","names":[],"sources":["../src/loro/loro-commands.ts","../src/loro/loro-cursor-plugin.ts","../src/loro/loro-keymap.ts","../src/loro/loro-sync-plugin.ts","../src/loro/loro-undo-plugin.ts","../src/loro/loro.ts"],"sourcesContent":["import {\n  defineCommands,\n  type Extension,\n} from '@prosekit/core'\nimport {\n  redo,\n  undo,\n} from 'loro-prosemirror'\n\nconst commands = {\n  undo: () => undo,\n  redo: () => redo,\n} as const\n\n/**\n * @internal\n */\nexport type LoroCommandsExtension = Extension<{\n  Commands: {\n    undo: []\n    redo: []\n  }\n}>\n\nexport function defineLoroCommands(): LoroCommandsExtension {\n  return defineCommands(commands)\n}\n","import {\n  definePlugin,\n  type PlainExtension,\n} from '@prosekit/core'\nimport type { Plugin } from '@prosekit/pm/state'\nimport type {\n  CursorAwareness,\n  CursorEphemeralStore,\n  CursorPluginOptions,\n} from 'loro-prosemirror'\nimport {\n  LoroCursorPlugin,\n  LoroEphemeralCursorPlugin,\n} from 'loro-prosemirror'\n\nexport interface LoroCursorOptions extends CursorPluginOptions {\n  awareness?: CursorAwareness\n  presence?: CursorEphemeralStore\n}\n\nexport function defineLoroCursorPlugin(\n  options: LoroCursorOptions,\n): PlainExtension {\n  return definePlugin(createLoroCursorPlugin(options))\n}\n\nfunction createLoroCursorPlugin(options: LoroCursorOptions): Plugin {\n  const { awareness, presence, ...rest } = options\n  if (awareness && presence) {\n    throw new Error('Only one of awareness and presence can be provided')\n  } else if (awareness) {\n    return LoroCursorPlugin(awareness, rest)\n  } else if (presence) {\n    return LoroEphemeralCursorPlugin(presence, rest)\n  } else {\n    throw new Error('Either awareness or presence must be provided')\n  }\n}\n","import {\n  defineKeymap,\n  isApple,\n  type Keymap,\n  type PlainExtension,\n} from '@prosekit/core'\nimport {\n  redo,\n  undo,\n} from 'loro-prosemirror'\n\nconst keymap: Keymap = {\n  'Mod-z': undo,\n  'Mod-Z': redo,\n}\n\nif (!isApple) {\n  keymap['Mod-y'] = redo\n}\n\nexport function defineLoroKeymap(): PlainExtension {\n  return defineKeymap(keymap)\n}\n","import {\n  definePlugin,\n  type PlainExtension,\n} from '@prosekit/core'\nimport {\n  LoroSyncPlugin,\n  type LoroSyncPluginProps,\n} from 'loro-prosemirror'\n\nexport function defineLoroSyncPlugin(\n  options: LoroSyncPluginProps,\n): PlainExtension {\n  return definePlugin(LoroSyncPlugin(options))\n}\n","import {\n  definePlugin,\n  type PlainExtension,\n} from '@prosekit/core'\nimport {\n  LoroUndoPlugin,\n  type LoroUndoPluginProps,\n} from 'loro-prosemirror'\n\nexport function defineLoroUndoPlugin(options: LoroUndoPluginProps): PlainExtension {\n  return definePlugin(LoroUndoPlugin(options))\n}\n","import {\n  Priority,\n  union,\n  withPriority,\n  type PlainExtension,\n  type Union,\n} from '@prosekit/core'\nimport type {\n  CursorAwareness,\n  CursorEphemeralStore,\n  CursorPluginOptions,\n  LoroDocType,\n  LoroSyncPluginProps,\n  LoroUndoPluginProps,\n} from 'loro-prosemirror'\n\nimport {\n  defineLoroCommands,\n  type LoroCommandsExtension,\n} from './loro-commands'\nimport { defineLoroCursorPlugin } from './loro-cursor-plugin'\nimport { defineLoroKeymap } from './loro-keymap'\nimport { defineLoroSyncPlugin } from './loro-sync-plugin'\nimport { defineLoroUndoPlugin } from './loro-undo-plugin'\n\nexport interface LoroOptions {\n  /**\n   * The Loro instance handles the state of shared data.\n   */\n  doc: LoroDocType\n\n  /**\n   * The (legacy) Awareness instance. One of `awareness` or `presence` must be provided.\n   */\n  awareness?: CursorAwareness\n\n  /**\n   * The CursorEphemeralStore instance. One of `awareness` or `presence` must be provided.\n   */\n  presence?: CursorEphemeralStore\n\n  /**\n   * Extra options for `LoroSyncPlugin`.\n   */\n  sync?: Omit<LoroSyncPluginProps, 'doc'>\n\n  /**\n   * Extra options for the `LoroUndoPlugin`.\n   */\n  undo?: Omit<LoroUndoPluginProps, 'doc'>\n\n  /**\n   * Extra options for `LoroCursorPlugin` or `LoroEphemeralCursorPlugin`.\n   */\n  cursor?: CursorPluginOptions\n}\n\n/**\n * @internal\n */\nexport type LoroExtension = Union<[LoroCommandsExtension, PlainExtension]>\n\n/**\n * @public\n */\nexport function defineLoro(options: LoroOptions): LoroExtension {\n  const { doc, awareness, presence, sync, undo, cursor } = options\n\n  return withPriority(\n    union([\n      defineLoroKeymap(),\n      defineLoroCommands(),\n      defineLoroCursorPlugin({ ...cursor, awareness, presence }),\n      defineLoroUndoPlugin({ ...undo, doc }),\n      defineLoroSyncPlugin({ ...sync, doc }),\n    ]),\n    Priority.high,\n  )\n}\n"],"mappings":";;;;AASA,MAAM,WAAW;CACf,YAAY;CACZ,YAAY;CACb;AAYD,SAAgB,qBAA4C;AAC1D,QAAO,eAAe,SAAS;;;;;ACLjC,SAAgB,uBACd,SACgB;AAChB,QAAO,aAAa,uBAAuB,QAAQ,CAAC;;AAGtD,SAAS,uBAAuB,SAAoC;CAClE,MAAM,EAAE,WAAW,UAAU,GAAG,SAAS;AACzC,KAAI,aAAa,SACf,OAAM,IAAI,MAAM,qDAAqD;UAC5D,UACT,QAAO,iBAAiB,WAAW,KAAK;UAC/B,SACT,QAAO,0BAA0B,UAAU,KAAK;KAEhD,OAAM,IAAI,MAAM,gDAAgD;;;;;ACxBpE,MAAM,SAAiB;CACrB,SAAS;CACT,SAAS;CACV;AAED,IAAI,CAAC,QACH,QAAO,WAAW;AAGpB,SAAgB,mBAAmC;AACjD,QAAO,aAAa,OAAO;;;;;ACZ7B,SAAgB,qBACd,SACgB;AAChB,QAAO,aAAa,eAAe,QAAQ,CAAC;;;;;ACH9C,SAAgB,qBAAqB,SAA8C;AACjF,QAAO,aAAa,eAAe,QAAQ,CAAC;;;;;;;;ACuD9C,SAAgB,WAAW,SAAqC;CAC9D,MAAM,EAAE,KAAK,WAAW,UAAU,MAAM,MAAM,WAAW;AAEzD,QAAO,aACL,MAAM;EACJ,kBAAkB;EAClB,oBAAoB;EACpB,uBAAuB;GAAE,GAAG;GAAQ;GAAW;GAAU,CAAC;EAC1D,qBAAqB;GAAE,GAAG;GAAM;GAAK,CAAC;EACtC,qBAAqB;GAAE,GAAG;GAAM;GAAK,CAAC;EACvC,CAAC,EACF,SAAS,KACV"}