---
import { MultipleFrameworksDemo } from './multiple-frameworks-demo.tsx'
import { FrameworkContent } from './framework-content.tsx'
import registry from 'prosekit-registry/registry.gen.json'
import PreactStory from '../../../stories/preact.astro'
import ReactStory from '../../../stories/react.astro'
import SolidStory from '../../../stories/solid.astro'
import SvelteStory from '../../../stories/svelte.astro'
import VueStory from '../../../stories/vue.astro'
import LitStory from '../../../stories/lit.astro'
import VanillaStory from '../../../stories/vanilla.astro'
import DemoCodeGroup from './demo-code-group.astro'

interface Props {
  story: string
  showCode?: boolean
}

const { story, showCode }: Props = Astro.props

const examples = registry.items.filter((example) => example.meta.story === story)

if (examples.length === 0) {
  throw new Error(`Unable to find examples for story ${story}`)
}

const frameworks = examples.map((example) => example.meta.framework)
---

{frameworks.includes('lit') && <script src="../../../stories/lit-register.ts"></script>}
{frameworks.includes('vanilla') && <script src="../../../stories/vanilla-register.ts"></script>}

<MultipleFrameworksDemo frameworks={frameworks} story={story} showCode={showCode} client:only="react">
  <FrameworkContent
    slot="storyContent"
    frameworks={frameworks}
    className="min-h-50 h-100 max-h-dvh overflow-y-hidden"
    client:only="react"
  >
    {frameworks.includes('lit') && <Fragment slot="litContent"><LitStory story={story} /></Fragment>}
    {frameworks.includes('preact') && <Fragment slot="preactContent"><PreactStory story={story} /></Fragment>}
    {frameworks.includes('react') && <Fragment slot="reactContent"><ReactStory story={story} /></Fragment>}
    {frameworks.includes('solid') && <Fragment slot="solidContent"><SolidStory story={story} /></Fragment>}
    {frameworks.includes('svelte') && <Fragment slot="svelteContent"><SvelteStory story={story} /></Fragment>}
    {frameworks.includes('vanilla') && <Fragment slot="vanillaContent"><VanillaStory story={story} /></Fragment>}
    {frameworks.includes('vue') && <Fragment slot="vueContent"><VueStory story={story} /></Fragment>}
  </FrameworkContent>

  <FrameworkContent
    slot="codeContent"
    frameworks={frameworks}
    className="border-t border-border"
    client:only="react"
  >
    {frameworks.includes('lit') && <Fragment slot="litContent"><DemoCodeGroup story={story} framework={'lit'} /></Fragment>}
    {frameworks.includes('preact') && <Fragment slot="preactContent"><DemoCodeGroup story={story} framework={'preact'} /></Fragment>}
    {frameworks.includes('react') && <Fragment slot="reactContent"><DemoCodeGroup story={story} framework={'react'} /></Fragment>}
    {frameworks.includes('solid') && <Fragment slot="solidContent"><DemoCodeGroup story={story} framework={'solid'} /></Fragment>}
    {frameworks.includes('svelte') && <Fragment slot="svelteContent"><DemoCodeGroup story={story} framework={'svelte'} /></Fragment>}
    {frameworks.includes('vanilla') && <Fragment slot="vanillaContent"><DemoCodeGroup story={story} framework={'vanilla'} /></Fragment>}
    {frameworks.includes('vue') && <Fragment slot="vueContent"><DemoCodeGroup story={story} framework={'vue'} /></Fragment>}
  </FrameworkContent>
</MultipleFrameworksDemo>
