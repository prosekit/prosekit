---
title: File
---

import Demo from '@/components/ui/demo/demo.astro';
import { CodeFile } from 'starlight-theme-nova/components';
import { Aside } from '@astrojs/starlight/components'

Handle file pasting, dropping, and uploading in the editor.

## Usage

It's common to upload files to a remote server when pasting or dropping them into the editor. Here are two approaches to implement this functionality:

### Basic Approach: Update After Upload

The simplest method is to update the document after uploading the file and receiving its URL:

```ts twoslash
function myUploader(file: File): Promise<string> {
  return Promise.resolve('https://example.com/file.png')
}

// ---cut---
import { insertNode } from 'prosekit/core'
import {
  defineFileDropHandler,
  defineFilePasteHandler,
} from 'prosekit/extensions/file'
import type { ImageAttrs } from 'prosekit/extensions/image'
import type { Command } from 'prosekit/pm/state'
import type { EditorView } from 'prosekit/pm/view'

async function handleUpload(view: EditorView, file: File, pos?: number) {
  // Upload the file to a remote server and get the URL
  const url: string = await myUploader(file)

  // Attributes for the image node
  const attrs: ImageAttrs = { src: url }

  // For paste events, `pos` is undefined. The image node will be
  // inserted at the current text cursor position.
  // For drop events, `pos` is the drop position. The image node will be
  // inserted at the drop position.
  const command: Command = insertNode({ type: 'image', attrs, pos })
  return command(view.state, view.dispatch, view)
}

const imagePasteExtension = defineFilePasteHandler(({ view, file }) => {
  if (!file.type.startsWith('image/')) return false
  void handleUpload(view, file)
  return true
})

const imageDropExtension = defineFileDropHandler(({ view, file, pos }) => {
  if (!file.type.startsWith('image/')) return false
  void handleUpload(view, file, pos)
  return true
})
```

<Aside>
For images, you can also use [`defineImageUploadHandler`] to handle the upload and insert the image node. This is a more advanced approach, as it allows the editor to show the images immediately, even before the upload is complete. You can see the full example at [image-view].
</Aside>

## API Reference

- [prosekit/extensions/file](/references/extensions/file)

{/* Link references */}

[`defineImageUploadHandler`]: /references/extensions/image#defineimageuploadhandler
[image-view]: /examples/image-view
