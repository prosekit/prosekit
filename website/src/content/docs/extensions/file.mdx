---
title: File
---

import Demo from '@/components/ui/demo/demo.astro';
import { CodeFile } from 'starlight-theme-nova/components';

Handle file pasting, dropping and uploading in the editor.

## Usage

It's common to upload files to a remote server when pasting or dropping files into the editor. Here are two approaches to implement this functionality:

### Basic Approach: Update After Upload

The simplest method is to update the document after uploading the file and receiving the file URL:

```ts twoslash
function myUploader(file: File): Promise<string> {
  return Promise.resolve('https://example.com/file.png')
}

// ---cut---
import { insertNode } from 'prosekit/core'
import {
  defineFileDropHandler,
  defineFilePasteHandler,
} from 'prosekit/extensions/file'
import type { ImageAttrs } from 'prosekit/extensions/image'
import type { Command } from 'prosekit/pm/state'
import type { EditorView } from 'prosekit/pm/view'

async function handleUpload(view: EditorView, file: File, pos?: number) {
  // Upload the file to a remote server and get the URL
  const url: string = await myUploader(file)

  // Attributes for the image node
  const attrs: ImageAttrs = { src: url }

  const command: Command = pos
    // For paste event, `pos` is undefined. The image node will be 
    // inserted at current text cursor position.
    ? insertNode({ type: 'image', attrs, pos })
    // For drop, `pos` is the drop position. The image node will be 
    // inserted at the drop position.
    : insertNode({ type: 'image', attrs })
  return command(view.state, view.dispatch, view)
}

const imagePasteExtension = defineFilePasteHandler(({ view, file }) => {
  if (!file.type.startsWith('image/')) return false
  void handleUpload(view, file)
  return true
})

const imageDropExtension = defineFileDropHandler(({ view, file, pos }) => {
  if (!file.type.startsWith('image/')) return false
  void handleUpload(view, file, pos)
  return true
})
```

Note: For image, you can also use the [`defineImageUploadHandler`] to handle the upload and insert the image node. This is a more advanced approach, as it allows the editor to show 
the images immediately before the upload is complete. You can check the full example at [image-view].

## API Reference

- [prosekit/extensions/file](/references/extensions/file)
- [`defineImageUploadHandler`](/references/extensions/image#defineimageuploadhandler)
- [image-view](/examples/image-view)
