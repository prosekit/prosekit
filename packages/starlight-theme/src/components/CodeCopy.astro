<script>
const DEFAULT_HTML = /* html */ `<span class="w-full h-full block i-lucide-clipboard"></span>`
const SUCCESS_HTML = /* html */ `<span class="w-full h-full block i-lucide-check"></span>`

class CodeCopyButton extends HTMLElement {
  constructor() {
    super()
  }

  connectedCallback() {
    this.innerHTML = DEFAULT_HTML

    const update = () => {
      this.innerHTML = state === 'ready' ? DEFAULT_HTML : SUCCESS_HTML
    }

    let state: 'ready' | 'success' = 'ready'
    update()

    this.addEventListener('click', () => {
      if (state === 'ready') {
        state = 'success'
        update()

        const code = this.dataset.code || ''
        void navigator.clipboard.writeText(code)
        setTimeout(() => {
          state = 'ready'
          update()
        }, 1500)
      }
    })
  }
}

customElements.define('code-copy-button', CodeCopyButton)
</script>
