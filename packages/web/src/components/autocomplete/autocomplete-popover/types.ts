import type { EventDeclarations } from '@aria-ui/core'
import {
  overlayPositionerEvents,
  overlayPositionerProps,
  type OverlayPositionerEvents,
  type OverlayPositionerProps,
} from '@aria-ui/overlay/elements'
import type { Editor } from '@prosekit/core'

export interface AutocompletePopoverProps extends OverlayPositionerProps {
  /**
   * The ProseKit editor instance.
   *
   * @default null
   * @hidden
   */
  editor: Editor | null

  /**
   * The regular expression to match the query text to autocomplete.
   *
   * @default null
   */
  regex: RegExp | null

  /**
   * A callback that is called when the query changes.
   */
  onQueryChange: ((query: string) => void) | null

  /**
   * A callback that is called when the open state changes.
   */
  onOpenChange: ((open: boolean) => void) | null

  /**
   * The placement of the popover, relative to the text cursor.
   *
   * @default "bottom-start"
   */
  placement: OverlayPositionerProps['placement']

  /**
   * The distance between the popover and the hovered block.
   *
   * @default 4
   */
  offset: OverlayPositionerProps['offset']

  /**
   * @default true
   */
  inline: OverlayPositionerProps['inline']

  /**
   * @default true
   */
  hoist: OverlayPositionerProps['hoist']

  /**
   * @default true
   */
  fitViewport: OverlayPositionerProps['fitViewport']

  /**
   * @default "The body element"
   */
  boundary: OverlayPositionerProps['boundary']

  /**
   * @default 8
   */
  overflowPadding: OverlayPositionerProps['overflowPadding']
}

const body = typeof document !== 'undefined' && document.querySelector('body')
const defaultBoundary = body || 'clippingAncestors'

/** @internal */
export const autocompletePopoverProps = {
  ...overlayPositionerProps,
  editor: { default: null },
  regex: { default: null },
  onQueryChange: { default: null },
  onOpenChange: { default: null },
  placement: { default: 'bottom-start' },
  offset: { default: 4 },
  inline: { default: true },
  hoist: { default: true },
  fitViewport: { default: true },
  boundary: { default: defaultBoundary },
  overflowPadding: { default: 8 },
} as const

export interface AutocompletePopoverEvents extends OverlayPositionerEvents {}

/** @internal */
export const autocompletePopoverEvents: EventDeclarations<AutocompletePopoverEvents> =
  overlayPositionerEvents
