{"version":3,"file":"prosekit-web-table-handle.js","names":["overlayPositionerProps","overlayPositionerEvents","overlayPositionerProps"],"sources":["../src/components/table-handle/context.ts","../src/components/table-handle/table-handle-column-root/setup.ts","../src/components/table-handle/table-handle-column-root/types.ts","../src/components/table-handle/table-handle-column-root/element.gen.ts","../src/components/table-handle/hooks/use-empty-image.ts","../src/components/table-handle/table-handle-column-trigger/setup.ts","../src/components/table-handle/table-handle-column-trigger/types.ts","../src/components/table-handle/table-handle-column-trigger/element.gen.ts","../src/components/table-handle/dnd.ts","../src/utils/css-feature-detection.ts","../src/utils/fade-color.ts","../src/utils/get-effective-background-color.ts","../src/components/table-handle/table-handle-drag-preview/render-preview.ts","../src/components/table-handle/table-handle-drag-preview/updater.ts","../src/components/table-handle/table-handle-drag-preview/setup.ts","../src/components/table-handle/table-handle-drag-preview/types.ts","../src/components/table-handle/table-handle-drag-preview/element.gen.ts","../src/components/table-handle/table-handle-drop-indicator/calc-drag-over.ts","../src/components/table-handle/table-handle-drop-indicator/updater.ts","../src/components/table-handle/table-handle-drop-indicator/setup.ts","../src/components/table-handle/table-handle-drop-indicator/types.ts","../src/components/table-handle/table-handle-drop-indicator/element.gen.ts","../src/components/table-handle/table-handle-popover-content/setup.ts","../src/components/table-handle/table-handle-popover-content/types.ts","../src/components/table-handle/table-handle-popover-content/element.gen.ts","../src/components/table-handle/table-handle-popover-item/setup.ts","../src/components/table-handle/table-handle-popover-item/types.ts","../src/components/table-handle/table-handle-popover-item/element.gen.ts","../src/hooks/use-editor-typing.ts","../src/hooks/use-selecting.ts","../src/components/table-handle/hooks/use-drop.ts","../src/components/table-handle/utils.ts","../src/components/table-handle/table-handle-root/setup.ts","../src/components/table-handle/table-handle-root/types.ts","../src/components/table-handle/table-handle-root/element.gen.ts","../src/components/table-handle/table-handle-row-root/setup.ts","../src/components/table-handle/table-handle-row-root/types.ts","../src/components/table-handle/table-handle-row-root/element.gen.ts","../src/components/table-handle/table-handle-row-trigger/setup.ts","../src/components/table-handle/table-handle-row-trigger/types.ts","../src/components/table-handle/table-handle-row-trigger/element.gen.ts"],"sourcesContent":["import { createContext, type Context } from '@aria-ui/core'\n\nimport type { DndInfo, HoveringCellInfo } from './utils.ts'\n\n/**\n * @internal\n */\nexport type TableHandleRootContext = HoveringCellInfo | null\n\n/**\n * @internal\n */\nexport const tableHandleRootContext: Context<TableHandleRootContext> = createContext(\n  'prosekit-table-handle-root-context',\n  null,\n)\n\n/**\n * @internal\n */\nexport type TableHandleDndContext = DndInfo\n\n/**\n * @internal\n */\nexport const defaultTableHandleDndContext: TableHandleDndContext = {\n  dragging: false,\n  direction: 'row',\n  draggingIndex: -1,\n  droppingIndex: -1,\n  x: -1,\n  y: -1,\n  startX: -1,\n  startY: -1,\n}\n\n/**\n * @internal\n */\nexport const tableHandleDndContext: Context<TableHandleDndContext> = createContext(\n  'prosekit-table-handle-dnd-context',\n  defaultTableHandleDndContext,\n)\n","import { createComputed, createSignal, useAttribute, useEffect, type ConnectableElement, type SignalState } from '@aria-ui/core'\nimport { menuRootProps, useMenuRoot, type MenuRootProps } from '@aria-ui/menu/elements'\nimport { useOverlayPositionerState } from '@aria-ui/overlay/elements'\nimport { usePresence } from '@aria-ui/presence'\n\nimport { getStateWithDefaults } from '../../../utils/get-default-state.ts'\nimport { getSafeEditorView } from '../../../utils/get-safe-editor-view.ts'\nimport { tableHandleRootContext } from '../context.ts'\n\nimport type { TableHandleColumnRootProps } from './types.ts'\n\n/**\n * @internal\n */\nexport function useTableHandleColumnRoot(\n  host: ConnectableElement,\n  { state }: { state: SignalState<TableHandleColumnRootProps> },\n): void {\n  const { editor, ...overlayState } = state\n\n  const rootContext = tableHandleRootContext.consume(host)\n\n  const colFirstCellPos = createComputed<number | undefined>(() => {\n    return rootContext.get()?.colFirstCellPos\n  })\n\n  const referenceCell = createComputed<HTMLElement | null>(() => {\n    const pos = colFirstCellPos.get()\n    const view = getSafeEditorView(editor.get())\n    if (!pos || !view) return null\n    return view.nodeDOM(pos) as HTMLElement | null\n  })\n\n  const contentOpen = createSignal(false)\n\n  // Close the menu when the hovering element is changed\n  // TODO: add a delay\n  useEffect(host, () => {\n    colFirstCellPos.get()\n    contentOpen.set(false)\n  })\n\n  useOverlayPositionerState(host, overlayState, {\n    reference: referenceCell,\n  })\n\n  const presence = createComputed(() => !!referenceCell.get())\n  useAttribute(host, 'data-state', () => (presence.get() ? 'open' : 'closed'))\n  usePresence(host, presence)\n\n  const menuRootState: SignalState<MenuRootProps> = getStateWithDefaults(\n    { open: contentOpen },\n    menuRootProps,\n  )\n\n  useMenuRoot(host, {\n    state: menuRootState,\n    emit: () => void 0,\n  })\n}\n","import type { EventDeclarations, PropDeclarations } from '@aria-ui/core'\nimport {\n  overlayPositionerEvents,\n  overlayPositionerProps,\n  type OverlayPositionerEvents,\n  type OverlayPositionerProps,\n} from '@aria-ui/overlay'\nimport type { Placement } from '@floating-ui/dom'\nimport type { Editor } from '@prosekit/core'\n\nexport interface TableHandleColumnRootProps extends Omit<OverlayPositionerProps, 'placement' | 'hoist' | 'flip' | 'shift' | 'hide'> {\n  /**\n   * The ProseKit editor instance.\n   *\n   * @default null\n   * @hidden\n   */\n  editor: Editor | null\n\n  /**\n   * The placement of the popover, relative to the hovered table cell.\n   *\n   * @default \"top\"\n   */\n  placement: Placement\n\n  /**\n   * Whether to use the browser [Popover API](https://developer.mozilla.org/en-US/docs/Web/API/Popover_API)\n   * to place the floating element on top of other page content.\n   *\n   * @default false\n   */\n  hoist: boolean\n\n  /**\n   * @default false\n   * @hidden\n   */\n  flip: boolean\n\n  /**\n   * @default false\n   * @hidden\n   */\n  shift: boolean\n\n  /**\n   * @default true\n   * @hidden\n   */\n  hide: boolean\n}\n\n/** @internal */\nexport const tableHandleColumnRootProps: PropDeclarations<TableHandleColumnRootProps> = Object.freeze({\n  ...overlayPositionerProps,\n  editor: { default: null },\n  placement: { default: 'top' },\n\n  // Enabling `hoist` will cause the popover to have a small delay when\n  // scrolling the page.\n  hoist: { default: false },\n\n  flip: { default: false },\n  shift: { default: false },\n  hide: { default: true },\n})\n\n/** @internal */\nexport interface TableHandleColumnRootEvents extends OverlayPositionerEvents {}\n\n/** @internal */\nexport const tableHandleColumnRootEvents: EventDeclarations<TableHandleColumnRootEvents> = overlayPositionerEvents\n","import { defineCustomElement, registerCustomElement, type BaseElementConstructor } from \"@aria-ui/core\"\n\nimport { useTableHandleColumnRoot } from \"./setup.ts\"\nimport { tableHandleColumnRootEvents, tableHandleColumnRootProps, type TableHandleColumnRootEvents, type TableHandleColumnRootProps } from \"./types.ts\"\n\nconst TableHandleColumnRootElementBase: BaseElementConstructor<TableHandleColumnRootProps> = defineCustomElement<\n  TableHandleColumnRootProps,\n  TableHandleColumnRootEvents\n>({\n  props: tableHandleColumnRootProps,\n  events: tableHandleColumnRootEvents,\n  setup: useTableHandleColumnRoot,\n})\nclass TableHandleColumnRootElement extends TableHandleColumnRootElementBase {}\n\nregisterCustomElement('prosekit-table-handle-column-root', TableHandleColumnRootElement)\n  \nexport { TableHandleColumnRootElement }\n","import type { ConnectableElement } from '@aria-ui/core'\nimport { useEffect } from '@aria-ui/core'\n\n/**\n * Returns a function that returns a 1x1 transparent image. This is used to\n * prevent the browser from showing the default drag image. An earth icon in\n * chrome is used as the default drag image. This image must be loaded before\n * the dragStart event triggers.\n *\n * See https://stackoverflow.com/a/40923520\n *\n * @internal\n */\nexport function useEmptyImage(\n  host: ConnectableElement,\n): () => HTMLImageElement | undefined {\n  let image: HTMLImageElement | undefined\n\n  useEffect(host, () => {\n    image = new Image(1, 1)\n    image.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'\n\n    return () => {\n      image?.remove()\n      image = undefined\n    }\n  })\n\n  return () => image\n}\n","import { useEffect, useEventListener, type ConnectableElement, type SetupOptions } from '@aria-ui/core'\nimport { useMenuTrigger } from '@aria-ui/menu/elements'\nimport { selectTableColumn } from '@prosekit/extensions/table'\n\nimport { tableHandleDndContext, tableHandleRootContext } from '../context.ts'\nimport { useEmptyImage } from '../hooks/use-empty-image.ts'\n\nimport type { TableHandleColumnTriggerEvents, TableHandleColumnTriggerProps } from './types.ts'\n\n/**\n * @internal\n */\nexport function useTableHandleColumnTrigger(\n  host: ConnectableElement,\n  { state }: SetupOptions<TableHandleColumnTriggerProps, TableHandleColumnTriggerEvents>,\n): void {\n  useMenuTrigger(host)\n\n  const context = tableHandleRootContext.consume(host)\n\n  const dndContext = tableHandleDndContext.consume(host)\n\n  useEventListener(host, 'pointerdown', () => {\n    const editor = state.editor.peek()\n    const cellPos = context.peek()?.cellPos\n    if (!editor || !cellPos) return\n    editor.exec(selectTableColumn({ head: cellPos }))\n  })\n\n  useEffect(host, () => {\n    host.draggable = true\n  })\n\n  const getEmptyImage = useEmptyImage(host)\n\n  useEventListener(host, 'dragstart', (event: DragEvent) => {\n    const dataTransfer = event.dataTransfer\n    if (dataTransfer) {\n      dataTransfer.effectAllowed = 'move'\n      const emptyImage = getEmptyImage()\n      if (emptyImage) {\n        dataTransfer.setDragImage(emptyImage, 0, 0)\n      }\n      dataTransfer.setData('application/x-prosekit-table-handle-drag', '')\n    }\n    const prev = dndContext.peek()\n    const index = context.peek()?.colIndex\n\n    if (index == null || index < 0) {\n      console.warn('[prosekit] Invalid column index for drag operation:', index)\n      event.preventDefault()\n      return\n    }\n\n    dndContext.set({\n      ...prev,\n      direction: 'col',\n      dragging: true,\n      draggingIndex: index,\n      startX: event.clientX,\n      startY: event.clientY,\n    })\n  })\n}\n","import type { EventDeclarations, PropDeclarations } from '@aria-ui/core'\nimport type { Editor } from '@prosekit/core'\nimport type { defineTableCommands } from '@prosekit/extensions/table'\n\ntype TableCommandsExtension = ReturnType<typeof defineTableCommands>\n\nexport interface TableHandleColumnTriggerProps {\n  editor: Editor<TableCommandsExtension> | null\n}\n\n/** @internal */\nexport const tableHandleColumnTriggerProps: PropDeclarations<TableHandleColumnTriggerProps> = {\n  editor: { default: null },\n}\n\n/** @internal */\nexport interface TableHandleColumnTriggerEvents {}\n\n/** @internal */\nexport const tableHandleColumnTriggerEvents: EventDeclarations<TableHandleColumnTriggerEvents> = {}\n","import { defineCustomElement, registerCustomElement, type BaseElementConstructor } from \"@aria-ui/core\"\n\nimport { useTableHandleColumnTrigger } from \"./setup.ts\"\nimport { tableHandleColumnTriggerEvents, tableHandleColumnTriggerProps, type TableHandleColumnTriggerEvents, type TableHandleColumnTriggerProps } from \"./types.ts\"\n\nconst TableHandleColumnTriggerElementBase: BaseElementConstructor<TableHandleColumnTriggerProps> = defineCustomElement<\n  TableHandleColumnTriggerProps,\n  TableHandleColumnTriggerEvents\n>({\n  props: tableHandleColumnTriggerProps,\n  events: tableHandleColumnTriggerEvents,\n  setup: useTableHandleColumnTrigger,\n})\nclass TableHandleColumnTriggerElement extends TableHandleColumnTriggerElementBase {}\n\nregisterCustomElement('prosekit-table-handle-column-trigger', TableHandleColumnTriggerElement)\n  \nexport { TableHandleColumnTriggerElement }\n","import { createComputed, useEffect, type ConnectableElement, type ReadonlySignal } from '@aria-ui/core'\nimport { computePosition, offset } from '@floating-ui/dom'\nimport { isHTMLElement } from '@ocavue/utils'\nimport type { Editor } from '@prosekit/core'\nimport type { EditorView } from '@prosekit/pm/view'\n\nimport { assignStyles } from '../../utils/assign-styles.ts'\nimport { getSafeEditorView } from '../../utils/get-safe-editor-view.ts'\n\nimport { tableHandleDndContext, tableHandleRootContext } from './context.ts'\n\nexport type OnInitParams = {\n  host: ConnectableElement\n  direction: 'row' | 'col'\n  dragging: boolean\n  draggingIndex: number\n  table: HTMLTableElement\n  cell: HTMLTableCellElement\n}\n\nexport function useInitDndPosition(\n  host: ConnectableElement,\n  editor: ReadonlySignal<Editor | null>,\n  onInit: (params: OnInitParams) => void,\n): void {\n  const dndContext = tableHandleDndContext.consume(host)\n  const rootContext = tableHandleRootContext.consume(host)\n\n  const draggingSignal = createComputed(() => {\n    const context = dndContext.get()\n    return context.dragging\n  })\n\n  const directionSignal = createComputed(() => {\n    const context = dndContext.get()\n    return context.direction\n  })\n\n  const draggingIndexSignal = createComputed(() => {\n    const context = dndContext.get()\n    return context.draggingIndex\n  })\n\n  useEffect(host, () => {\n    const view = getSafeEditorView(editor.get())\n    if (!view) return\n\n    const dragging = draggingSignal.get()\n    const direction = directionSignal.get()\n\n    host.dataset.direction = direction\n    host.dataset.dragging = dragging.toString()\n\n    const draggingIndex = draggingIndexSignal.get()\n\n    const relatedDOMs = getDndRelatedDOMs(view, rootContext.peek()?.cellPos, draggingIndex, direction)\n    if (!relatedDOMs) return\n    const { table, cell } = relatedDOMs\n\n    onInit({\n      host,\n      direction,\n      dragging,\n      draggingIndex,\n      table,\n      cell,\n    })\n\n    if (!dragging) return\n\n    let cancelled = false\n\n    void computePosition(cell, host, {\n      placement: direction === 'row' ? 'right' : 'bottom',\n      middleware: [\n        offset(({ rects }) => {\n          if (direction === 'col') {\n            return -rects.reference.height\n          }\n          return -rects.reference.width\n        }),\n      ],\n    }).then(({ x, y }) => {\n      if (cancelled) return\n      assignStyles(host, {\n        left: `${x}px`,\n        top: `${y}px`,\n      })\n    })\n\n    return () => {\n      cancelled = true\n    }\n  })\n}\n\nfunction getTableDOMByPos(view: EditorView, pos: number): HTMLTableElement | undefined {\n  const dom = view.domAtPos(pos).node\n  if (!dom) return\n  const element = isHTMLElement(dom) ? dom : dom.parentElement\n  const table = element?.closest('table')\n  return table ?? undefined\n}\n\nfunction getTargetFirstCellDOM(table: HTMLTableElement, index: number, direction: 'row' | 'col'): HTMLTableCellElement | undefined {\n  if (direction === 'row') {\n    const row = table.querySelectorAll('tr')[index]\n    const cell = row?.querySelector<HTMLTableCellElement>('td, th')\n    return cell ?? undefined\n  } else {\n    const row = table.querySelector('tr')\n    const cell = row?.querySelectorAll<HTMLTableCellElement>('td, th')[index]\n    return cell ?? undefined\n  }\n}\n\nexport function getDndRelatedDOMs(\n  view: EditorView,\n  cellPos: number | undefined,\n  draggingIndex: number,\n  direction: 'row' | 'col',\n): { table: HTMLTableElement; cell: HTMLTableCellElement } | undefined {\n  if (cellPos == null) return\n  const table = getTableDOMByPos(view, cellPos)\n  if (!table) return\n  const cell = getTargetFirstCellDOM(table, draggingIndex, direction)\n  if (!cell) return\n  return { table, cell }\n}\n","import { once } from '@ocavue/utils'\n\nexport const isColorMixSupported: () => boolean = once(() => {\n  try {\n    return CSS.supports('background-color', 'color-mix(in srgb, red, blue)')\n  } catch {\n    return false\n  }\n})\n","import { isColorMixSupported } from './css-feature-detection.ts'\n\n/**\n * Convert a color to a color with opacity\n * @param color - The color to convert\n * @param opacity - The opacity to apply\n * @returns The converted color if color-mix is supported, otherwise undefined\n */\nexport function fadeColor(color: CSSStyleValue, opacity: number): string | undefined {\n  if (isColorMixSupported()) {\n    const transparentWeight = (1 - opacity) * 100\n    const colorWeight = opacity * 100\n    return `color-mix(in srgb, ${color} ${colorWeight}%, transparent ${transparentWeight}%)`\n  }\n}\n","export function getEffectiveBackgroundColor(element: HTMLElement): string | undefined {\n  let current: HTMLElement | null = element\n\n  while (current) {\n    const style = current.ownerDocument.defaultView?.getComputedStyle(current)\n    const backgroundColor = style?.backgroundColor\n\n    if (\n      backgroundColor\n      && backgroundColor !== 'transparent'\n      // Chrome returns `rgba(0, 0, 0, 0)` for transparent colors.\n      && backgroundColor !== 'rgba(0, 0, 0, 0)'\n    ) {\n      return backgroundColor\n    }\n\n    current = current.parentElement\n  }\n\n  return undefined\n}\n","import { assignStyles } from '../../../utils/assign-styles.ts'\nimport { cloneElement, deepCloneElement } from '../../../utils/clone-element.ts'\nimport { fadeColor } from '../../../utils/fade-color.ts'\nimport { getEffectiveBackgroundColor } from '../../../utils/get-effective-background-color.ts'\nimport { injectStyle } from '../../../utils/inject-style.ts'\n\nexport function clearPreviewDOM(previewRoot: HTMLElement): void {\n  while (previewRoot.firstChild) {\n    previewRoot.removeChild(previewRoot.firstChild)\n  }\n}\n\nexport function createPreviewDOM(\n  table: HTMLTableElement,\n  previewRoot: HTMLElement,\n  index: number,\n  direction: 'row' | 'col',\n): void {\n  clearPreviewDOM(previewRoot)\n\n  const [previewTable, previewTableStyle] = cloneElement(table)\n  injectStyle(previewRoot, previewTableStyle)\n  unsetSize(previewTable)\n\n  const tableBody = table.querySelector('tbody')\n  const [previewTableBody, previewTableBodyStyle] = tableBody\n    ? cloneElement(tableBody)\n    : [table.ownerDocument.createElement('tbody'), '']\n  injectStyle(previewRoot, previewTableBodyStyle)\n  unsetSize(previewTableBody)\n\n  // Get effective background color and apply it with some opacity\n  const backgroundColor = getEffectiveBackgroundColor(table)\n  if (backgroundColor) {\n    const backgroundColorWithOpacity = fadeColor(backgroundColor, 0.8)\n    if (backgroundColorWithOpacity) {\n      assignStyles(previewTable, { backgroundColor: backgroundColorWithOpacity })\n    }\n  }\n\n  previewTable.appendChild(previewTableBody)\n  previewRoot.appendChild(previewTable)\n\n  const rows = table.querySelectorAll('tr')\n\n  if (direction === 'row') {\n    const row = rows[index]\n    const [previewRow, previewRowStyle] = deepCloneElement(row)\n    injectStyle(previewRoot, previewRowStyle)\n    previewTableBody.appendChild(previewRow)\n  } else {\n    rows.forEach((row) => {\n      const [previewRow, previewRowStyle] = cloneElement(row)\n      injectStyle(previewRoot, previewRowStyle)\n      unsetSize(previewRow)\n      const cells = row.querySelectorAll('td, th')\n      const cell = cells[index]\n      if (cell) {\n        const [previewCell, previewCellStyle] = deepCloneElement(cell)\n        injectStyle(previewRoot, previewCellStyle)\n        previewRow.appendChild(previewCell)\n        previewTableBody.appendChild(previewRow)\n      }\n    })\n  }\n}\n\nfunction unsetSize(element: HTMLElement) {\n  assignStyles(element, {\n    width: 'unset',\n    height: 'unset',\n    minWidth: 'unset',\n    minHeight: 'unset',\n    maxWidth: 'unset',\n    maxHeight: 'unset',\n  })\n}\n","import { createComputed, useEffect, type ConnectableElement, type ReadonlySignal } from '@aria-ui/core'\nimport { computePosition, type ReferenceElement } from '@floating-ui/dom'\nimport type { Editor } from '@prosekit/core'\n\nimport { assignStyles } from '../../../utils/assign-styles.ts'\nimport { getSafeEditorView } from '../../../utils/get-safe-editor-view.ts'\nimport { tableHandleDndContext, tableHandleRootContext } from '../context.ts'\nimport { getDndRelatedDOMs } from '../dnd.ts'\n\nexport function useUpdatePreviewPosition(host: ConnectableElement, editor: ReadonlySignal<Editor | null>): void {\n  const dndContext = tableHandleDndContext.consume(host)\n  const rootContext = tableHandleRootContext.consume(host)\n\n  const draggingSignal = createComputed(() => {\n    const context = dndContext.get()\n    return context.dragging\n  })\n\n  const clientXSignal = createComputed(() => {\n    const context = dndContext.get()\n    return context.x\n  })\n\n  const clientYSignal = createComputed(() => {\n    const context = dndContext.get()\n    return context.y\n  })\n\n  useEffect(host, () => {\n    const view = getSafeEditorView(editor.get())\n    if (!view) return\n\n    if (!draggingSignal.get()) return\n\n    const { draggingIndex, direction } = dndContext.peek()\n    const x = clientXSignal.get()\n    const y = clientYSignal.get()\n\n    const relatedDOMs = getDndRelatedDOMs(view, rootContext.peek()?.cellPos, draggingIndex, direction)\n    if (!relatedDOMs) return\n    const { cell } = relatedDOMs\n\n    let cancelled = false\n\n    void computePosition(\n      getVirtualElement(cell, x, y),\n      host,\n      { placement: direction === 'row' ? 'right' : 'bottom' },\n    ).then(({ x, y }) => {\n      if (cancelled) return\n\n      if (direction === 'row') {\n        assignStyles(host, {\n          top: `${y}px`,\n        })\n        return\n      }\n\n      if (direction === 'col') {\n        assignStyles(host, {\n          left: `${x}px`,\n        })\n        return\n      }\n    })\n\n    return () => {\n      cancelled = true\n    }\n  })\n}\n\nfunction getVirtualElement(cell: HTMLTableCellElement, x: number, y: number): ReferenceElement {\n  return {\n    contextElement: cell,\n    getBoundingClientRect: () => {\n      const rect = cell.getBoundingClientRect()\n      return {\n        width: rect.width,\n        height: rect.height,\n        right: x + rect.width / 2,\n        bottom: y + rect.height / 2,\n        top: y - rect.height / 2,\n        left: x - rect.width / 2,\n        x: x - rect.width / 2,\n        y: y - rect.height / 2,\n      }\n    },\n  }\n}\n","import { useEffect, type ConnectableElement, type SignalState } from '@aria-ui/core'\n\nimport { assignStyles } from '../../../utils/assign-styles.ts'\nimport { useInitDndPosition, type OnInitParams } from '../dnd.ts'\n\nimport { clearPreviewDOM, createPreviewDOM } from './render-preview.ts'\nimport type { TableHandleDragPreviewProps } from './types.ts'\nimport { useUpdatePreviewPosition } from './updater.ts'\n\n/**\n * @internal\n */\nexport function useTableHandleDragPreview(host: ConnectableElement, { state }: { state: SignalState<TableHandleDragPreviewProps> }): void {\n  const { editor } = state\n\n  useEffect(host, () => {\n    assignStyles(host, {\n      position: 'absolute',\n      // Make sure drop on preview will trigger drop event on the host\n      pointerEvents: 'none',\n    })\n  })\n\n  useInitDndPosition(host, editor, onInitPreviewPosition)\n\n  useUpdatePreviewPosition(host, editor)\n}\n\nfunction onInitPreviewPosition({ host, direction, dragging, table, cell, draggingIndex }: OnInitParams): void {\n  assignStyles(host, {\n    display: dragging ? 'block' : 'none',\n  })\n\n  if (!dragging) {\n    clearPreviewDOM(host)\n    return\n  }\n\n  createPreviewDOM(table, host, draggingIndex, direction)\n\n  const tableRect = table.getBoundingClientRect()\n  const cellRect = cell.getBoundingClientRect()\n\n  if (direction === 'col') {\n    assignStyles(host, {\n      width: `${cellRect.width}px`,\n      height: `${tableRect.height}px`,\n    })\n  }\n\n  if (direction === 'row') {\n    assignStyles(host, {\n      width: `${tableRect.width}px`,\n      height: `${cellRect.height}px`,\n    })\n  }\n}\n","import type { EventDeclarations, PropDeclarations } from '@aria-ui/core'\nimport type { Editor } from '@prosekit/core'\n\nexport interface TableHandleDragPreviewProps {\n  editor: Editor | null\n}\n\nexport const tableHandleDragPreviewProps: PropDeclarations<TableHandleDragPreviewProps> = {\n  editor: { default: null },\n}\n\nexport interface TableHandleDragPreviewEvents {}\n\nexport const tableHandleDragPreviewEvents: EventDeclarations<TableHandleDragPreviewEvents> = {}\n","import { defineCustomElement, registerCustomElement, type BaseElementConstructor } from \"@aria-ui/core\"\n\nimport { useTableHandleDragPreview } from \"./setup.ts\"\nimport { tableHandleDragPreviewEvents, tableHandleDragPreviewProps, type TableHandleDragPreviewEvents, type TableHandleDragPreviewProps } from \"./types.ts\"\n\nconst TableHandleDragPreviewElementBase: BaseElementConstructor<TableHandleDragPreviewProps> = defineCustomElement<\n  TableHandleDragPreviewProps,\n  TableHandleDragPreviewEvents\n>({\n  props: tableHandleDragPreviewProps,\n  events: tableHandleDragPreviewEvents,\n  setup: useTableHandleDragPreview,\n})\nclass TableHandleDragPreviewElement extends TableHandleDragPreviewElementBase {}\n\nregisterCustomElement('prosekit-table-handle-drag-preview', TableHandleDragPreviewElement)\n  \nexport { TableHandleDragPreviewElement }\n","function findDragOverElement(\n  elements: Element[],\n  pointer: number,\n  axis: 'x' | 'y',\n): [Element, number] | undefined {\n  const startProp = axis === 'x' ? 'left' : 'top'\n  const endProp = axis === 'x' ? 'right' : 'bottom'\n  const lastIndex = elements.length - 1\n\n  const index = elements.findIndex((el, index) => {\n    const rect = el.getBoundingClientRect()\n    const boundaryStart = rect[startProp]\n    const boundaryEnd = rect[endProp]\n\n    // The pointer is within the boundary of the current element.\n    if (boundaryStart <= pointer && pointer <= boundaryEnd) return true\n    // The pointer is beyond the last element.\n    if (index === lastIndex && pointer > boundaryEnd) return true\n    // The pointer is before the first element.\n    if (index === 0 && pointer < boundaryStart) return true\n\n    return false\n  })\n\n  return index >= 0 ? [elements[index], index] : undefined\n}\n\nexport function getDragOverColumn(\n  table: HTMLTableElement,\n  pointerX: number,\n): [element: Element, index: number] | undefined {\n  const firstRow = table.querySelector('tr')\n  if (!firstRow) return\n  const cells = Array.from(firstRow.children)\n  return findDragOverElement(cells, pointerX, 'x')\n}\n\nexport function getDragOverRow(\n  table: HTMLTableElement,\n  pointerY: number,\n): [element: Element, index: number] | undefined {\n  const rows = Array.from(table.querySelectorAll('tr'))\n  return findDragOverElement(rows, pointerY, 'y')\n}\n","import { createComputed, useEffect, type ConnectableElement, type ReadonlySignal } from '@aria-ui/core'\nimport { computePosition, offset } from '@floating-ui/dom'\nimport type { Editor } from '@prosekit/core'\n\nimport { assignStyles } from '../../../utils/assign-styles.ts'\nimport { getSafeEditorView } from '../../../utils/get-safe-editor-view.ts'\nimport { tableHandleDndContext, tableHandleRootContext } from '../context.ts'\nimport { getDndRelatedDOMs } from '../dnd.ts'\n\nimport { getDragOverColumn, getDragOverRow } from './calc-drag-over.ts'\n\nexport function useUpdateIndicatorPosition(host: ConnectableElement, editor: ReadonlySignal<Editor | null>, handleWidth: number): void {\n  const dndContext = tableHandleDndContext.consume(host)\n  const rootContext = tableHandleRootContext.consume(host)\n\n  const draggingSignal = createComputed(() => {\n    const context = dndContext.get()\n    return context.dragging\n  })\n\n  const clientXSignal = createComputed(() => {\n    const context = dndContext.get()\n    return context.x\n  })\n\n  const clientYSignal = createComputed(() => {\n    const context = dndContext.get()\n    return context.y\n  })\n\n  const startXSignal = createComputed(() => {\n    return dndContext.get().startX\n  })\n\n  const startYSignal = createComputed(() => {\n    return dndContext.get().startY\n  })\n\n  useEffect(host, () => {\n    const view = getSafeEditorView(editor.get())\n    if (!view) return\n\n    if (!draggingSignal.get()) return\n\n    const { draggingIndex, direction } = dndContext.peek()\n    const x = clientXSignal.get()\n    const y = clientYSignal.get()\n\n    const relatedDOMs = getDndRelatedDOMs(view, rootContext.peek()?.cellPos, draggingIndex, direction)\n    if (!relatedDOMs) return\n    const { table } = relatedDOMs\n\n    let cancelled = false\n    const cleanup = () => {\n      cancelled = true\n    }\n\n    if (direction === 'col') {\n      const direction = startXSignal.get() > x ? 'left' : 'right'\n      const dragOverColumn = getDragOverColumn(table, x)\n\n      if (dragOverColumn) {\n        const [col, index] = dragOverColumn\n        dndContext.set({ ...dndContext.peek(), droppingIndex: index })\n        void computePosition(col, host, {\n          placement: direction === 'left' ? 'left' : 'right',\n          middleware: [offset(direction === 'left' ? -1 * handleWidth : 0)],\n        }).then(({ x }) => {\n          if (cancelled) return\n          assignStyles(host, { left: `${x}px` })\n        })\n      }\n\n      return cleanup\n    }\n\n    if (direction === 'row') {\n      const direction = startYSignal.get() > y ? 'up' : 'down'\n      const dragOverRow = getDragOverRow(table, y)\n\n      if (dragOverRow) {\n        const [row, index] = dragOverRow\n        dndContext.set({ ...dndContext.peek(), droppingIndex: index })\n        void computePosition(row, host, {\n          placement: direction === 'up' ? 'top' : 'bottom',\n          middleware: [offset(direction === 'up' ? -1 * handleWidth : 0)],\n        }).then(({ y }) => {\n          if (cancelled) return\n          assignStyles(host, { top: `${y}px` })\n        })\n      }\n\n      return cleanup\n    }\n  })\n}\n","import { useEffect, type ConnectableElement, type SignalState } from '@aria-ui/core'\n\nimport { assignStyles } from '../../../utils/assign-styles.ts'\nimport { useInitDndPosition, type OnInitParams } from '../dnd.ts'\n\nimport type { TableHandleDropIndicatorProps } from './types.ts'\nimport { useUpdateIndicatorPosition } from './updater.ts'\n\nconst HANDLE_WIDTH = 2\n\n/**\n * @internal\n */\nexport function useTableHandleDropIndicator(\n  host: ConnectableElement,\n  { state }: { state: SignalState<TableHandleDropIndicatorProps> },\n): void {\n  const { editor } = state\n\n  useEffect(host, () => {\n    assignStyles(host, {\n      pointerEvents: 'none',\n      position: 'absolute',\n    })\n  })\n\n  useInitDndPosition(host, editor, onInitIndicatorPosition)\n\n  useUpdateIndicatorPosition(host, editor, HANDLE_WIDTH)\n}\n\nfunction onInitIndicatorPosition({ host, direction, dragging, table }: OnInitParams): void {\n  assignStyles(host, {\n    display: dragging ? 'block' : 'none',\n  })\n\n  const tableRect = table.getBoundingClientRect()\n\n  if (direction === 'col') {\n    assignStyles(host, {\n      width: `${HANDLE_WIDTH}px`,\n      height: `${tableRect.height}px`,\n    })\n  }\n\n  if (direction === 'row') {\n    assignStyles(host, {\n      width: `${tableRect.width}px`,\n      height: `${HANDLE_WIDTH}px`,\n    })\n  }\n}\n","import type { EventDeclarations, PropDeclarations } from '@aria-ui/core'\nimport type { Editor } from '@prosekit/core'\nimport type { TableCommandsExtension } from '@prosekit/extensions/table'\n\nexport interface TableHandleDropIndicatorProps {\n  editor: Editor<TableCommandsExtension> | null\n}\n\nexport const tableHandleDropIndicatorProps: PropDeclarations<TableHandleDropIndicatorProps> = {\n  editor: { default: null },\n}\n\nexport interface TableHandleDropIndicatorEvents {}\n\nexport const tableHandleDropIndicatorEvents: EventDeclarations<TableHandleDropIndicatorEvents> = {}\n","import { defineCustomElement, registerCustomElement, type BaseElementConstructor } from \"@aria-ui/core\"\n\nimport { useTableHandleDropIndicator } from \"./setup.ts\"\nimport { tableHandleDropIndicatorEvents, tableHandleDropIndicatorProps, type TableHandleDropIndicatorEvents, type TableHandleDropIndicatorProps } from \"./types.ts\"\n\nconst TableHandleDropIndicatorElementBase: BaseElementConstructor<TableHandleDropIndicatorProps> = defineCustomElement<\n  TableHandleDropIndicatorProps,\n  TableHandleDropIndicatorEvents\n>({\n  props: tableHandleDropIndicatorProps,\n  events: tableHandleDropIndicatorEvents,\n  setup: useTableHandleDropIndicator,\n})\nclass TableHandleDropIndicatorElement extends TableHandleDropIndicatorElementBase {}\n\nregisterCustomElement('prosekit-table-handle-drop-indicator', TableHandleDropIndicatorElement)\n  \nexport { TableHandleDropIndicatorElement }\n","import {\n  createComputed,\n  createSignal,\n  useEffect,\n  type ConnectableElement,\n  type ReadonlySignal,\n  type SetupOptions,\n  type SignalState,\n  type TypedEventTarget,\n} from '@aria-ui/core'\nimport { menuContentProps, useMenuContent, type MenuContentProps } from '@aria-ui/menu/elements'\n\nimport { getStateWithDefaults } from '../../../utils/get-default-state.ts'\nimport { tableHandleRootContext } from '../context.ts'\n\nimport type { TableHandlePopoverContentEvents, TableHandlePopoverContentProps } from './types.ts'\n\n/**\n * @internal\n */\nexport function useTableHandlePopoverContent(\n  host: ConnectableElement,\n  {\n    state,\n    emit,\n  }: SetupOptions<\n    TableHandlePopoverContentProps,\n    TableHandlePopoverContentEvents\n  >,\n): void {\n  const rootContext = tableHandleRootContext.consume(host)\n  const open = createComputed(() => !!rootContext.get())\n  const keyDownTarget = useKeyDownTarget(host, open)\n\n  const menuContentState: SignalState<MenuContentProps> = getStateWithDefaults(\n    {\n      placement: state.placement,\n      offset: state.offset,\n      eventTarget: createSignal(keyDownTarget),\n    },\n    menuContentProps,\n  )\n\n  useMenuContent(host, { state: menuContentState, emit })\n}\n\nfunction useKeyDownTarget(\n  element: ConnectableElement,\n  open: ReadonlySignal<boolean>,\n): TypedEventTarget<'keydown'> {\n  const keydownHandlers: Array<(event: KeyboardEvent) => void> = []\n\n  useEffect(element, () => {\n    const handleKeydown = (event: KeyboardEvent) => {\n      if (event.isComposing || event.defaultPrevented || !open.get()) {\n        return false\n      }\n      keydownHandlers.forEach((handler) => handler(event))\n    }\n\n    document.addEventListener('keydown', handleKeydown)\n\n    return () => {\n      document.removeEventListener('keydown', handleKeydown)\n    }\n  })\n\n  return {\n    addEventListener: (type, listener) => {\n      if (type === 'keydown') {\n        keydownHandlers.push(listener)\n      }\n    },\n    removeEventListener: (type, listener) => {\n      if (type === 'keydown') {\n        const index = keydownHandlers.indexOf(listener)\n        if (index !== -1) {\n          keydownHandlers.splice(index, 1)\n        }\n      }\n    },\n  }\n}\n","import type { EventDeclarations, PropDeclarations } from '@aria-ui/core'\nimport { menuContentEvents, menuContentProps, type MenuContentEvents, type MenuContentProps } from '@aria-ui/menu/elements'\nimport type { Editor } from '@prosekit/core'\n\nexport interface TableHandlePopoverContentProps extends Omit<MenuContentProps, 'placement' | 'offset'> {\n  /**\n   * @default 'bottom-start'\n   */\n  placement: MenuContentProps['placement']\n\n  /**\n   * @default {mainAxis: -4, crossAxis: 4}\n   */\n  offset: MenuContentProps['offset']\n\n  editor: Editor | null\n}\n\n/** @internal */\nexport const tableHandlePopoverContentProps: PropDeclarations<TableHandlePopoverContentProps> = Object.freeze({\n  ...menuContentProps,\n  placement: { default: 'right-start' },\n  offset: { default: { mainAxis: -4, crossAxis: 4 } },\n  editor: { default: null },\n})\n\nexport interface TableHandlePopoverContentEvents extends MenuContentEvents {}\n\n/** @internal */\nexport const tableHandlePopoverContentEvents: EventDeclarations<TableHandlePopoverContentEvents> = Object.freeze({\n  ...menuContentEvents,\n})\n","import { defineCustomElement, registerCustomElement, type BaseElementConstructor } from \"@aria-ui/core\"\n\nimport { useTableHandlePopoverContent } from \"./setup.ts\"\nimport { tableHandlePopoverContentEvents, tableHandlePopoverContentProps, type TableHandlePopoverContentEvents, type TableHandlePopoverContentProps } from \"./types.ts\"\n\nconst TableHandlePopoverContentElementBase: BaseElementConstructor<TableHandlePopoverContentProps> = defineCustomElement<\n  TableHandlePopoverContentProps,\n  TableHandlePopoverContentEvents\n>({\n  props: tableHandlePopoverContentProps,\n  events: tableHandlePopoverContentEvents,\n  setup: useTableHandlePopoverContent,\n})\nclass TableHandlePopoverContentElement extends TableHandlePopoverContentElementBase {}\n\nregisterCustomElement('prosekit-table-handle-popover-content', TableHandlePopoverContentElement)\n  \nexport { TableHandlePopoverContentElement }\n","import type { ConnectableElement, SetupOptions } from '@aria-ui/core'\nimport { useMenuItem } from '@aria-ui/menu/elements'\n\nimport type { TableHandlePopoverItemEvents, TableHandlePopoverItemProps } from './types.ts'\n\n/**\n * @internal\n */\nexport function useTableHandlePopoverItem(\n  element: ConnectableElement,\n  {\n    state,\n    emit,\n  }: SetupOptions<TableHandlePopoverItemProps, TableHandlePopoverItemEvents>,\n): void {\n  useMenuItem(element, { state, emit })\n}\n","import type { EventDeclarations, PropDeclarations } from '@aria-ui/core'\nimport { menuItemEvents, menuItemProps, type MenuItemEvents, type MenuItemProps } from '@aria-ui/menu'\n\nexport interface TableHandlePopoverItemProps extends MenuItemProps {}\n\n/** @internal */\nexport const tableHandlePopoverItemProps: PropDeclarations<TableHandlePopoverItemProps> = {\n  ...menuItemProps,\n}\n\nexport interface TableHandlePopoverItemEvents extends MenuItemEvents {}\n\n/** @internal */\nexport const tableHandlePopoverItemEvents: EventDeclarations<TableHandlePopoverItemEvents> = {\n  ...menuItemEvents,\n}\n","import { defineCustomElement, registerCustomElement, type BaseElementConstructor } from \"@aria-ui/core\"\n\nimport { useTableHandlePopoverItem } from \"./setup.ts\"\nimport { tableHandlePopoverItemEvents, tableHandlePopoverItemProps, type TableHandlePopoverItemEvents, type TableHandlePopoverItemProps } from \"./types.ts\"\n\nconst TableHandlePopoverItemElementBase: BaseElementConstructor<TableHandlePopoverItemProps> = defineCustomElement<\n  TableHandlePopoverItemProps,\n  TableHandlePopoverItemEvents\n>({\n  props: tableHandlePopoverItemProps,\n  events: tableHandlePopoverItemEvents,\n  setup: useTableHandlePopoverItem,\n})\nclass TableHandlePopoverItemElement extends TableHandlePopoverItemElementBase {}\n\nregisterCustomElement('prosekit-table-handle-popover-item', TableHandlePopoverItemElement)\n  \nexport { TableHandlePopoverItemElement }\n","import { createSignal, type ConnectableElement, type ReadonlySignal } from '@aria-ui/core'\nimport { defineDOMEventHandler, union, type Editor } from '@prosekit/core'\n\nimport { useEditorExtension } from './use-editor-extension.ts'\n\nexport function useEditorTyping(\n  host: ConnectableElement,\n  editor: ReadonlySignal<Editor | null>,\n): ReadonlySignal<boolean> {\n  const typing = createSignal(false)\n\n  const handleKeypress = () => {\n    typing.set(true)\n  }\n\n  const handlePointerMove = () => {\n    typing.set(false)\n  }\n\n  const extension = union(\n    defineDOMEventHandler('keypress', handleKeypress),\n    defineDOMEventHandler('pointermove', handlePointerMove),\n  )\n\n  useEditorExtension(host, editor, extension)\n\n  return typing\n}\n","import type { ReadonlySignal } from '@aria-ui/core'\nimport { createSignal, useEffect, type ConnectableElement } from '@aria-ui/core'\nimport type { Editor } from '@prosekit/core'\n\nimport { getSafeEditorView } from '../utils/get-safe-editor-view.ts'\n\n/**\n * Detect if the user is selecting text inside the editor, in which case some\n * components should be disabled or hidden.\n */\nexport function useSelecting(\n  host: ConnectableElement,\n  editor: ReadonlySignal<Editor | null>,\n  enabled: ReadonlySignal<boolean>,\n): ReadonlySignal<boolean> {\n  const selecting = createSignal(false)\n  const isPointerDown = createSignal(false)\n\n  useEffect(host, () => {\n    if (!enabled.get()) {\n      return\n    }\n\n    const view = getSafeEditorView(editor.peek())\n    if (!view) return\n\n    const { dom, root } = view\n    if (!root) return\n\n    // When the user starts selecting text, we set the selecting signal to true.\n    const handlePointerDown = () => {\n      selecting.set(true)\n      isPointerDown.set(true)\n    }\n    const handlePointerUp = () => {\n      isPointerDown.set(false)\n    }\n    // When the user moves the pointer and the pointer is not down, we set the\n    // selecting signal to false again.\n    const handleMouseMove = () => {\n      if (!isPointerDown.get()) {\n        selecting.set(false)\n      }\n    }\n\n    // Only listen to pointer down events on the editor\n    dom.addEventListener('pointerdown', handlePointerDown)\n    root.addEventListener('pointerup', handlePointerUp)\n    root.addEventListener('pointermove', handleMouseMove)\n\n    return () => {\n      dom.removeEventListener('pointerdown', handlePointerDown)\n      root.removeEventListener('pointerup', handlePointerUp)\n      root.removeEventListener('pointermove', handleMouseMove)\n    }\n  })\n\n  return selecting\n}\n","import { createComputed, useEffect, type ConnectableElement, type ReadonlySignal, type Signal } from '@aria-ui/core'\nimport type { Editor } from '@prosekit/core'\nimport { moveTableColumn, moveTableRow } from '@prosekit/extensions/table'\n\nimport { getSafeEditorView } from '../../../utils/get-safe-editor-view.ts'\nimport type { TableHandleDndContext } from '../context.ts'\n\nexport function useDrop(\n  host: ConnectableElement,\n  editor: ReadonlySignal<Editor | null>,\n  dndContext: Signal<TableHandleDndContext>,\n): void {\n  const dragging = createComputed(() => dndContext.get().dragging)\n\n  useEffect(host, () => {\n    const view = getSafeEditorView(editor.get())\n    if (!view || !view.editable) return\n\n    const ownerDocument = view.dom?.ownerDocument\n    if (!ownerDocument) return\n\n    const handleDrop = () => {\n      if (!dragging.peek()) return\n      const editorValue = editor.peek()\n      if (!editorValue) return\n      const { droppingIndex, draggingIndex, direction } = dndContext.peek()\n\n      // Validate indices\n      if (draggingIndex < 0 || droppingIndex < 0) {\n        console.warn('[prosekit] Invalid drag indices:', { draggingIndex, droppingIndex })\n        return\n      }\n\n      if (direction === 'row') {\n        editorValue.exec(moveTableRow({\n          from: draggingIndex,\n          to: droppingIndex,\n        }))\n        return\n      }\n      if (direction === 'col') {\n        editorValue.exec(moveTableColumn({\n          from: draggingIndex,\n          to: droppingIndex,\n        }))\n        return\n      }\n    }\n\n    // To make `drop` event work, we need to prevent the default behavior of the\n    // `dragover` event for drop zone. Here we set the whole document as the\n    // drop zone so that even the mouse moves outside the editor, the `drop`\n    // event will still be triggered.\n    const handleDragOver = (event: DragEvent) => {\n      if (!dragging.peek()) return\n      event.preventDefault()\n      const prev = dndContext.peek()\n\n      dndContext.set({\n        ...prev,\n        dragging: true,\n        x: event.clientX,\n        y: event.clientY,\n      })\n    }\n\n    const handleDragEnd = () => {\n      if (!dragging.peek()) return\n      const prev = dndContext.peek()\n      dndContext.set({\n        ...prev,\n        dragging: false,\n      })\n    }\n\n    ownerDocument.addEventListener('dragover', handleDragOver)\n    ownerDocument.addEventListener('drop', handleDrop)\n    ownerDocument.addEventListener('dragend', handleDragEnd)\n    return () => {\n      ownerDocument.removeEventListener('dragover', handleDragOver)\n      ownerDocument.removeEventListener('drop', handleDrop)\n      ownerDocument.removeEventListener('dragend', handleDragEnd)\n    }\n  })\n}\n","import type { EditorView } from '@prosekit/pm/view'\nimport { cellAround, TableMap } from 'prosemirror-tables'\n\nexport interface HoveringCellInfo {\n  rowIndex: number\n  colIndex: number\n  cellPos: number\n  rowFirstCellPos: number\n  colFirstCellPos: number\n}\n\nexport interface DndInfo {\n  dragging: boolean\n  direction: 'row' | 'col'\n  draggingIndex: number\n  droppingIndex: number\n  x: number\n  y: number\n  startX: number\n  startY: number\n}\n\nexport function isHoveringCellInfoEqual(\n  a?: HoveringCellInfo | null,\n  b?: HoveringCellInfo | null,\n): boolean {\n  if (!a && !b) return true\n  if (!a || !b) return false\n  return (\n    a.rowIndex === b.rowIndex\n    && a.colIndex === b.colIndex\n    && a.cellPos === b.cellPos\n    && a.rowFirstCellPos === b.rowFirstCellPos\n    && a.colFirstCellPos === b.colFirstCellPos\n  )\n}\n\n/**\n * Copied from https://github.com/ProseMirror/prosemirror-tables/blob/v1.5.0/src/columnresizing.ts#L256\n *\n * @internal\n */\nfunction domCellAround(target: HTMLElement | null): HTMLElement | null {\n  while (target && target.nodeName != 'TD' && target.nodeName != 'TH') {\n    target = target.classList?.contains('ProseMirror')\n      ? null\n      : (target.parentNode as HTMLElement | null)\n  }\n  return target\n}\n\nexport function getHoveringCell(\n  view: EditorView,\n  event: MouseEvent,\n): HoveringCellInfo | undefined {\n  const domCell = domCellAround(event.target as HTMLElement | null)\n  if (!domCell) return\n\n  const { left, top, width, height } = domCell.getBoundingClientRect()\n  const eventPos = view.posAtCoords({\n    // Use the center coordinates of the cell to ensure we're within the\n    // selected cell. This prevents potential issues when the mouse is on the\n    // border of two cells.\n    left: left + width / 2,\n    top: top + height / 2,\n  })\n  if (!eventPos) return\n\n  const $cellPos = cellAround(view.state.doc.resolve(eventPos.pos))\n  if (!$cellPos) return\n\n  const map = TableMap.get($cellPos.node(-1))\n  const tableStart = $cellPos.start(-1)\n  const cellRect = map.findCell($cellPos.pos - tableStart)\n  const rowIndex = cellRect.top\n  const colIndex = cellRect.left\n\n  return {\n    rowIndex,\n    colIndex,\n    cellPos: $cellPos.pos,\n    rowFirstCellPos: getCellPos(map, tableStart, rowIndex, 0),\n    colFirstCellPos: getCellPos(map, tableStart, 0, colIndex),\n  }\n}\n\nfunction getCellPos(\n  map: TableMap,\n  tableStart: number,\n  rowIndex: number,\n  colIndex: number,\n) {\n  const cellIndex = getCellIndex(map, rowIndex, colIndex)\n  const posInTable = map.map[cellIndex]\n  return tableStart + posInTable\n}\n\nfunction getCellIndex(\n  map: TableMap,\n  rowIndex: number,\n  colIndex: number,\n): number {\n  return map.width * rowIndex + colIndex\n}\n","import {\n  createComputed,\n  createSignal,\n  useEffect,\n  type ConnectableElement,\n  type ReadonlySignal,\n  type Signal,\n  type SignalState,\n} from '@aria-ui/core'\nimport { defineDOMEventHandler, type Editor } from '@prosekit/core'\nimport type { EditorView } from '@prosekit/pm/view'\n\nimport { useEditorExtension } from '../../../hooks/use-editor-extension.ts'\nimport { useEditorTyping } from '../../../hooks/use-editor-typing.ts'\nimport { useScrolling } from '../../../hooks/use-scrolling.ts'\nimport { useSelecting } from '../../../hooks/use-selecting.ts'\nimport {\n  defaultTableHandleDndContext,\n  tableHandleDndContext,\n  tableHandleRootContext,\n  type TableHandleDndContext,\n  type TableHandleRootContext,\n} from '../context.ts'\nimport { useDrop } from '../hooks/use-drop.ts'\nimport { getHoveringCell, isHoveringCellInfoEqual, type HoveringCellInfo } from '../utils.ts'\n\nimport type { TableHandleRootProps } from './types.ts'\n\n/**\n * @internal\n */\nexport function useTableHandleRoot(\n  host: ConnectableElement,\n  { state }: { state: SignalState<TableHandleRootProps> },\n): void {\n  const { editor } = state\n\n  const context = createSignal<TableHandleRootContext>(null)\n  const dndContext = createSignal<TableHandleDndContext>(defaultTableHandleDndContext)\n\n  const hoveringCell = useHoveringCell(host, editor)\n  const typing = useEditorTyping(host, editor)\n  const isInTable = createComputed(() => !!hoveringCell.get())\n  const selecting = useSelecting(host, editor, isInTable)\n  const scrolling = useScrolling(host)\n  const canShow = createComputed(() => {\n    return !typing.get() && !selecting.get() && !scrolling.get()\n  })\n\n  useEffect(host, () => {\n    context.set(canShow.get() ? hoveringCell.get() : null)\n  })\n\n  tableHandleRootContext.provide(host, context)\n  tableHandleDndContext.provide(host, dndContext)\n\n  useDrop(host, editor, dndContext)\n}\n\nfunction useHoveringCell(\n  host: ConnectableElement,\n  editor: ReadonlySignal<Editor | null>,\n): Signal<HoveringCellInfo | null> {\n  const hoveringCell = createSignal<HoveringCellInfo | null>(null)\n\n  const extension = defineCellHoverHandler((curr: HoveringCellInfo | null) => {\n    const prev = hoveringCell.peek()\n    if (!isHoveringCellInfoEqual(prev, curr)) {\n      hoveringCell.set(curr)\n    }\n  })\n\n  useEditorExtension(host, editor, extension)\n\n  return hoveringCell\n}\n\nfunction defineCellHoverHandler(\n  handler: (hoveringCell: HoveringCellInfo | null) => void,\n) {\n  const pointerHandler = (view: EditorView, event: PointerEvent) => {\n    const hoveringCell = getHoveringCell(view, event)\n    return handler(hoveringCell ?? null)\n  }\n  return defineDOMEventHandler('pointerover', pointerHandler)\n}\n","import type { EventDeclarations, PropDeclarations } from '@aria-ui/core'\nimport type { Editor } from '@prosekit/core'\n\nexport interface TableHandleRootProps {\n  /**\n   * The ProseKit editor instance.\n   *\n   * @default null\n   * @hidden\n   */\n  editor: Editor | null\n}\n\n/** @internal */\nexport const tableHandleRootProps: PropDeclarations<TableHandleRootProps> = {\n  editor: { default: null },\n}\n\n/** @internal */\nexport interface TableHandleRootEvents {}\n\n/** @internal */\nexport const tableHandleRootEvents: EventDeclarations<TableHandleRootEvents> = {}\n","import { defineCustomElement, registerCustomElement, type BaseElementConstructor } from \"@aria-ui/core\"\n\nimport { useTableHandleRoot } from \"./setup.ts\"\nimport { tableHandleRootEvents, tableHandleRootProps, type TableHandleRootEvents, type TableHandleRootProps } from \"./types.ts\"\n\nconst TableHandleRootElementBase: BaseElementConstructor<TableHandleRootProps> = defineCustomElement<\n  TableHandleRootProps,\n  TableHandleRootEvents\n>({\n  props: tableHandleRootProps,\n  events: tableHandleRootEvents,\n  setup: useTableHandleRoot,\n})\nclass TableHandleRootElement extends TableHandleRootElementBase {}\n\nregisterCustomElement('prosekit-table-handle-root', TableHandleRootElement)\n  \nexport { TableHandleRootElement }\n","import {\n  createComputed,\n  createSignal,\n  defineEmit,\n  useAttribute,\n  useEffect,\n  type ConnectableElement,\n  type SetupOptions,\n} from '@aria-ui/core'\nimport { menuRootEvents, menuRootProps, useMenuRoot } from '@aria-ui/menu/elements'\nimport { useOverlayPositionerState } from '@aria-ui/overlay/elements'\nimport { usePresence } from '@aria-ui/presence'\n\nimport { getStateWithDefaults } from '../../../utils/get-default-state.ts'\nimport { getSafeEditorView } from '../../../utils/get-safe-editor-view.ts'\nimport { tableHandleRootContext } from '../context.ts'\n\nimport type { TableHandleRowRootEvents, TableHandleRowRootProps } from './types.ts'\n\n/**\n * @internal\n */\nexport function useTableHandleRowRoot(\n  host: ConnectableElement,\n  { state }: SetupOptions<TableHandleRowRootProps, TableHandleRowRootEvents>,\n): void {\n  const { editor, ...overlayState } = state\n\n  const rootContext = tableHandleRootContext.consume(host)\n\n  const rowFirstCellPos = createComputed<number | undefined>(() => {\n    return rootContext.get()?.rowFirstCellPos\n  })\n\n  const referenceCell = createComputed<HTMLElement | null>(() => {\n    const pos = rowFirstCellPos.get()\n    const view = getSafeEditorView(editor.get())\n    if (!pos || !view) return null\n    return view.nodeDOM(pos) as HTMLElement | null\n  })\n\n  const contentOpen = createSignal(false)\n\n  // Close the menu when the hovering element is changed\n  // TODO: add a delay\n  useEffect(host, () => {\n    rowFirstCellPos.get()\n    contentOpen.set(false)\n  })\n\n  useOverlayPositionerState(host, overlayState, {\n    reference: referenceCell,\n  })\n\n  const presence = createComputed(() => !!referenceCell.get())\n  useAttribute(host, 'data-state', () => (presence.get() ? 'open' : 'closed'))\n  usePresence(host, presence)\n\n  const menuRootState = getStateWithDefaults(\n    {\n      open: contentOpen,\n    },\n    menuRootProps,\n  )\n\n  useMenuRoot(host, {\n    state: menuRootState,\n    emit: defineEmit(host, menuRootEvents),\n  })\n}\n","import type { EventDeclarations, PropDeclarations } from '@aria-ui/core'\nimport { overlayPositionerProps, type OverlayPositionerEvents, type OverlayPositionerProps } from '@aria-ui/overlay'\nimport type { Placement } from '@floating-ui/dom'\nimport type { Editor } from '@prosekit/core'\n\nexport interface TableHandleRowRootProps extends Omit<OverlayPositionerProps, 'placement' | 'hoist' | 'flip' | 'shift' | 'hide'> {\n  /**\n   * The ProseKit editor instance.\n   *\n   * @default null\n   * @hidden\n   */\n  editor: Editor | null\n\n  /**\n   * The placement of the popover, relative to the hovered table cell.\n   *\n   * @default \"left\"\n   */\n  placement: Placement\n\n  /**\n   * Whether to use the browser [Popover API](https://developer.mozilla.org/en-US/docs/Web/API/Popover_API)\n   * to place the floating element on top of other page content.\n   *\n   * @default false\n   */\n  hoist: boolean\n\n  /**\n   * @default false\n   * @hidden\n   */\n  flip: boolean\n\n  /**\n   * @default false\n   * @hidden\n   */\n  shift: boolean\n\n  /**\n   * @default true\n   * @hidden\n   */\n  hide: boolean\n}\n\n/** @internal */\nexport const tableHandleRowRootProps: PropDeclarations<TableHandleRowRootProps> = {\n  ...overlayPositionerProps,\n  editor: { default: null },\n  placement: { default: 'left' },\n\n  // Enabling `hoist` will cause the popover to have a small delay when\n  // scrolling the page.\n  hoist: { default: false },\n\n  flip: { default: false },\n  shift: { default: false },\n  hide: { default: true },\n}\n\n/** @internal */\nexport interface TableHandleRowRootEvents extends OverlayPositionerEvents {}\n\n/** @internal */\nexport const tableHandleRowRootEvents: EventDeclarations<TableHandleRowRootEvents> = {}\n","import { defineCustomElement, registerCustomElement, type BaseElementConstructor } from \"@aria-ui/core\"\n\nimport { useTableHandleRowRoot } from \"./setup.ts\"\nimport { tableHandleRowRootEvents, tableHandleRowRootProps, type TableHandleRowRootEvents, type TableHandleRowRootProps } from \"./types.ts\"\n\nconst TableHandleRowRootElementBase: BaseElementConstructor<TableHandleRowRootProps> = defineCustomElement<\n  TableHandleRowRootProps,\n  TableHandleRowRootEvents\n>({\n  props: tableHandleRowRootProps,\n  events: tableHandleRowRootEvents,\n  setup: useTableHandleRowRoot,\n})\nclass TableHandleRowRootElement extends TableHandleRowRootElementBase {}\n\nregisterCustomElement('prosekit-table-handle-row-root', TableHandleRowRootElement)\n  \nexport { TableHandleRowRootElement }\n","import { useEffect, useEventListener, type ConnectableElement, type SetupOptions } from '@aria-ui/core'\nimport { useMenuTrigger } from '@aria-ui/menu/elements'\nimport { selectTableRow } from '@prosekit/extensions/table'\n\nimport { tableHandleDndContext, tableHandleRootContext } from '../context.ts'\nimport { useEmptyImage } from '../hooks/use-empty-image.ts'\n\nimport type { TableHandleRowTriggerEvents, TableHandleRowTriggerProps } from './types.ts'\n\n/**\n * @internal\n */\nexport function useTableHandleRowTrigger(\n  host: ConnectableElement,\n  { state }: SetupOptions<TableHandleRowTriggerProps, TableHandleRowTriggerEvents>,\n): void {\n  useMenuTrigger(host)\n\n  const context = tableHandleRootContext.consume(host)\n\n  const dndContext = tableHandleDndContext.consume(host)\n\n  useEventListener(host, 'pointerdown', () => {\n    const editor = state.editor.peek()\n    const cellPos = context.peek()?.cellPos\n    if (!editor || !cellPos) return\n    editor.exec(selectTableRow({ head: cellPos }))\n  })\n\n  useEffect(host, () => {\n    host.draggable = true\n  })\n\n  const getEmptyImage = useEmptyImage(host)\n\n  useEventListener(host, 'dragstart', (event: DragEvent) => {\n    const dataTransfer = event.dataTransfer\n    if (dataTransfer) {\n      dataTransfer.effectAllowed = 'move'\n      const emptyImage = getEmptyImage()\n      if (emptyImage) {\n        dataTransfer.setDragImage(emptyImage, 0, 0)\n      }\n    }\n    const prev = dndContext.peek()\n    const index = context.peek()?.rowIndex\n\n    if (index == null || index < 0) {\n      console.warn('[prosekit] Invalid row index for drag operation:', index)\n      event.preventDefault()\n      return\n    }\n\n    dndContext.set({\n      ...prev,\n      direction: 'row',\n      dragging: true,\n      draggingIndex: index,\n      startX: event.clientX,\n      startY: event.clientY,\n    })\n  })\n}\n","import type { EventDeclarations, PropDeclarations } from '@aria-ui/core'\nimport type { Editor } from '@prosekit/core'\nimport type { defineTableCommands } from '@prosekit/extensions/table'\n\ntype TableCommandsExtension = ReturnType<typeof defineTableCommands>\n\nexport interface TableHandleRowTriggerProps {\n  editor: Editor<TableCommandsExtension> | null\n}\n\n/** @internal */\nexport const tableHandleRowTriggerProps: PropDeclarations<TableHandleRowTriggerProps> = {\n  editor: { default: null },\n}\n\nexport interface TableHandleRowTriggerEvents {\n  select: CustomEvent<void>\n}\n\n/** @internal */\nexport const tableHandleRowTriggerEvents: EventDeclarations<TableHandleRowTriggerEvents> = {\n  select: {},\n}\n","import { defineCustomElement, registerCustomElement, type BaseElementConstructor } from \"@aria-ui/core\"\n\nimport { useTableHandleRowTrigger } from \"./setup.ts\"\nimport { tableHandleRowTriggerEvents, tableHandleRowTriggerProps, type TableHandleRowTriggerEvents, type TableHandleRowTriggerProps } from \"./types.ts\"\n\nconst TableHandleRowTriggerElementBase: BaseElementConstructor<TableHandleRowTriggerProps> = defineCustomElement<\n  TableHandleRowTriggerProps,\n  TableHandleRowTriggerEvents\n>({\n  props: tableHandleRowTriggerProps,\n  events: tableHandleRowTriggerEvents,\n  setup: useTableHandleRowTrigger,\n})\nclass TableHandleRowTriggerElement extends TableHandleRowTriggerElementBase {}\n\nregisterCustomElement('prosekit-table-handle-row-trigger', TableHandleRowTriggerElement)\n  \nexport { TableHandleRowTriggerElement }\n"],"mappings":"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"}